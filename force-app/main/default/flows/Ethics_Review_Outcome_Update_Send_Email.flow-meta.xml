<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <description>Get all the Files on the Ethics Request and concatenate their names</description>
        <name>Concatenate_File_Names</name>
        <label>Concatenate File Names</label>
        <locationX>1728</locationX>
        <locationY>923</locationY>
        <actionName>GetFileNamesInConcatenatedList</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Save_Concatenated_Files_on_Ethics_Request</targetReference>
        </connector>
        <faultConnector>
            <targetReference>ErrorOutcome</targetReference>
        </faultConnector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>recordIds</name>
            <value>
                <elementReference>EthicsRequestId</elementReference>
            </value>
        </inputParameters>
        <outputParameters>
            <assignToReference>EthicsRequest.I_RS_Attached_File_Names__c</assignToReference>
            <name>output</name>
        </outputParameters>
    </actionCalls>
    <actionCalls>
        <name>Get_Ethics_Record_Type_Name</name>
        <label>Get Ethics Record Type Name</label>
        <locationX>1570</locationX>
        <locationY>182</locationY>
        <actionName>FlowGetRecordTypeNameById</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Get_Email_Template_Matrix</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>objectName</name>
            <value>
                <stringValue>Ethics_Request__c</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>recordTypeId</name>
            <value>
                <elementReference>EthicsRequest.RecordTypeId</elementReference>
            </value>
        </inputParameters>
        <outputParameters>
            <assignToReference>ethicsRequestRecordTypeName</assignToReference>
            <name>output</name>
        </outputParameters>
    </actionCalls>
    <actionCalls>
        <name>Get_Record_Type_Name_Ethics_Request</name>
        <label>Get Record Type Name - Ethics Request</label>
        <locationX>1440</locationX>
        <locationY>82</locationY>
        <actionName>FlowGetRecordTypeNameById</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Get_Ethics_Record_Type_Name</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>objectName</name>
            <value>
                <stringValue>Ethics_Request__c</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>recordTypeId</name>
            <value>
                <elementReference>EthicsRequest.RecordTypeId</elementReference>
            </value>
        </inputParameters>
        <outputParameters>
            <assignToReference>targetRecordTypeName</assignToReference>
            <name>output</name>
        </outputParameters>
    </actionCalls>
    <actionCalls>
        <name>Get_Record_Type_Name_Post_Approval</name>
        <label>Get Record Type Name - Post Approval</label>
        <locationX>1434</locationX>
        <locationY>260</locationY>
        <actionName>FlowGetRecordTypeNameById</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Get_Ethics_Record_Type_Name</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>objectName</name>
            <value>
                <stringValue>Ethics_Post_Approval__c</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>recordTypeId</name>
            <value>
                <elementReference>EthicsPostApproval.RecordTypeId</elementReference>
            </value>
        </inputParameters>
        <outputParameters>
            <assignToReference>targetRecordTypeName</assignToReference>
            <name>output</name>
        </outputParameters>
    </actionCalls>
    <actionCalls>
        <name>Send_Email</name>
        <label>Send Email</label>
        <locationX>1167</locationX>
        <locationY>795</locationY>
        <actionName>SendEmail</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Did_Email_Send_Succeed</targetReference>
        </connector>
        <faultConnector>
            <targetReference>ErrorOutcome</targetReference>
        </faultConnector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>allOrNoneEmailSend</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>orgWideEmailAddressId</name>
            <value>
                <elementReference>Get_Organisation_Wide_Address.Id</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>recordId</name>
            <value>
                <elementReference>targetRecordId</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>saveAsActivity</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>SendBCCtheEmailAddressesFromThisCollectionOfContacts</name>
        </inputParameters>
        <inputParameters>
            <name>SendBCCthisOneEmailAddress</name>
            <value>
                <elementReference>Get_Organisation_Wide_Address.Address</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>SendCCtheEmailAddressesFromThisCollectionOfContacts</name>
            <value>
                <elementReference>ContactsForCCList</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderDisplayName</name>
            <value>
                <elementReference>Get_Organisation_Wide_Address.DisplayName</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>templateTargetObjectId</name>
            <value>
                <elementReference>EthicsRequest.I_RS_Principal_Investigator_Contact__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>templateID</name>
            <value>
                <elementReference>Get_Email_Template_Id.Id</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>throwFlowExceptionOnSendEmailException</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <outputParameters>
            <assignToReference>maxDailyRecipientsReached</assignToReference>
            <name>maxDailyRecipientsReached</name>
        </outputParameters>
    </actionCalls>
    <apiVersion>49.0</apiVersion>
    <assignments>
        <name>Add_Contact_to_CC_List</name>
        <label>Add Contact to CC List</label>
        <locationX>2332</locationX>
        <locationY>711</locationY>
        <assignmentItems>
            <assignToReference>ContactsForCCList</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>ContactToAddToCCList</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ContactsForCCIdSet</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>ContactToAddToCCList.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_through_Ethics_Pesonnel</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_Contact_to_To_list</name>
        <label>Add Contact to To list</label>
        <locationX>2218</locationX>
        <locationY>560</locationY>
        <assignmentItems>
            <assignToReference>ContactsForToList</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>ContactsForToList</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Ethics_Personnel</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>ErrorOutcome</name>
        <label>ErrorOutcome</label>
        <locationX>807</locationX>
        <locationY>688</locationY>
        <assignmentItems>
            <assignToReference>IsError</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ErrorMessage</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>The email has not been sent. Check to make sure all the required fields are complete. If the error continues please contact the Support Team.</stringValue>
            </value>
        </assignmentItems>
    </assignments>
    <assignments>
        <name>Initialise_Contact_to_add_to_CC_List</name>
        <label>Initialise Contact to add to CC List</label>
        <locationX>2333</locationX>
        <locationY>846</locationY>
        <assignmentItems>
            <assignToReference>ContactToAddToCCList.Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_Ethics_Pesonnel.I_RS_Contact_Researcher__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ContactToAddToCCList.Email</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_Ethics_Pesonnel.I_RS_Contact_Researcher__r.Email</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_Contact_to_CC_List</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Initialise_Contact_to_add_to_To_list</name>
        <label>Initialise Contact to add to To list</label>
        <locationX>2217</locationX>
        <locationY>420</locationY>
        <assignmentItems>
            <assignToReference>ContacttoAddtoToList.Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>EthicsRequest.I_RS_Principal_Investigator_Contact__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_Contact_to_To_list</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>IsSuccess_True_Assign_Variables</name>
        <label>IsSuccess True - Assign Variables</label>
        <locationX>805</locationX>
        <locationY>841</locationY>
        <assignmentItems>
            <assignToReference>IsSuccess</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
    </assignments>
    <assignments>
        <name>No_Matching_Email_Template_Found</name>
        <label>No Matching Email Template Found</label>
        <locationX>2024</locationX>
        <locationY>214</locationY>
        <assignmentItems>
            <assignToReference>IsError</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ErrorMessage</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>No email exists for the email type &apos;{!StatusValue}&apos;. If you believe this is incorrect please contact the support team.</stringValue>
            </value>
        </assignmentItems>
    </assignments>
    <assignments>
        <description>Ethics Request Id is simply the Id passed in</description>
        <name>Set_Ethics_Request_Id_to_input_variable</name>
        <label>Set Ethics Request Id to input variable</label>
        <locationX>773</locationX>
        <locationY>50</locationY>
        <assignmentItems>
            <assignToReference>EthicsRequestId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>targetRecordId</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Ethics_Request</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Ethics Request Id is parent lookup on Ethics Post Approval</description>
        <name>Set_Ethics_Request_Id_to_parent_field</name>
        <label>Set Ethics Request Id to parent field</label>
        <locationX>777</locationX>
        <locationY>324</locationY>
        <assignmentItems>
            <assignToReference>EthicsRequestId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>EthicsPostApproval.I_RS_Ethics_Request__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Ethics_Request</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Contact_already_exists_in_CC_List</name>
        <label>Contact already exists in CC List</label>
        <locationX>2328</locationX>
        <locationY>1026</locationY>
        <defaultConnector>
            <targetReference>Initialise_Contact_to_add_to_CC_List</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Contact_already_exists_in_CC_List_Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>ContactsForCCIdSet</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <elementReference>Loop_through_Ethics_Pesonnel.I_RS_Contact_Researcher__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Loop_through_Ethics_Pesonnel</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Did_Email_Send_Succeed</name>
        <label>Did Email Send Succeed</label>
        <locationX>990</locationX>
        <locationY>931</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Did_Email_Send_Succeed_Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>maxDailyRecipientsReached</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>IsSuccess_True_Assign_Variables</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Email_Template_Matrix_Found</name>
        <label>Email Template Matrix Found</label>
        <locationX>1826</locationX>
        <locationY>363</locationY>
        <defaultConnector>
            <targetReference>No_Matching_Email_Template_Found</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Email_Template_Matrix_Found_Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Email_Template_Matrix</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Email_Template_Id</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Ethics_Request_has_Principal_Investigator</name>
        <label>Ethics Request has Principal Investigator</label>
        <locationX>1037</locationX>
        <locationY>211</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Ethics_Request_has_Principal_Investigator_Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>EthicsRequest.I_RS_Principal_Investigator_Contact__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Object_Type_Get_Record_Type_Name</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Get_Up_To_Date_List_on_Related_File_Names</name>
        <label>Get Up To Date List on Related File Names</label>
        <locationX>1743</locationX>
        <locationY>705</locationY>
        <defaultConnector>
            <targetReference>Send_Email</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Get_Up_To_Date_List_on_Related_File_Names_Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Email_Template_Matrix.I_RS_Template_needs_Related_File_names__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Concatenate_File_Names</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <description>Get Review Outcome variable from record concerned</description>
        <name>Object_Type_Get_Record_Type_Name</name>
        <label>Object Type - Get Record Type Name</label>
        <locationX>1233</locationX>
        <locationY>208</locationY>
        <defaultConnector>
            <targetReference>Get_Record_Type_Name_Ethics_Request</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Object_Type_Get_Review_Outcome_Post_Approval</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>ObjectType</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Ethics_Post_Approval__c</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Record_Type_Name_Post_Approval</targetReference>
            </connector>
            <label>Post Approval</label>
        </rules>
    </decisions>
    <decisions>
        <name>Object_Type_Set_Target_Id</name>
        <label>Object Type - Set Target Id</label>
        <locationX>511</locationX>
        <locationY>164</locationY>
        <defaultConnector>
            <targetReference>Set_Ethics_Request_Id_to_input_variable</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Object_Type_Set_Target_Id_Post_Approval</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>ObjectType</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Ethics_Post_Approval__c</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Ethics_Post_Approval</targetReference>
            </connector>
            <label>Post Approval</label>
        </rules>
    </decisions>
    <decisions>
        <description>Conditions that state whether this Ethics Personnel needs to be included in the CC list</description>
        <name>Personnel_is_valid_for_CC</name>
        <label>Personnel is valid for CC</label>
        <locationX>2068</locationX>
        <locationY>1025</locationY>
        <defaultConnector>
            <targetReference>Loop_through_Ethics_Pesonnel</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Personnel_is_valid_for_CC_Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Loop_through_Ethics_Pesonnel.I_RS_End_Date__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Loop_through_Ethics_Pesonnel.I_RS_Contact_Researcher__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>EthicsRequest.I_RS_Principal_Investigator_Contact__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Contact_already_exists_in_CC_List</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <description>Sends a notification email to the personnel involved in an Ethics Request. Currently, when the Ethics Request, or one if its Ethics Post Approvals, Approval Review Outcome changes</description>
    <formulas>
        <description>The API name of the email template to send - is based on the object type (Ethics Request or Ethics Post Approval) and Ethics Application Review Outcome.</description>
        <name>EmailTemplateName</name>
        <dataType>String</dataType>
        <expression>CASE({!ObjectType}, 

&quot;Ethics_Request__c&quot;, 

CASE({!EthicsRequest.I_RS_Ethics_Application_Review_Outcome__c}, 
&quot;Expired&quot;, &quot;Ethics_Request_Expiry&quot;,
&quot;Another template&quot;)
,

&quot;Ethics_Post_Approval__c&quot;,

CASE({!EthicsRequest.I_RS_Ethics_Application_Review_Outcome__c},
&quot;Expired&quot;, &quot;Ethics_Request_Expiry&quot;,
&quot;Another Template&quot;)

,

&quot;Another Template&quot;

)</expression>
    </formulas>
    <formulas>
        <name>OrganisationWideAddressDisplayName</name>
        <dataType>String</dataType>
        <expression>CASE(
{!EthicsRequest.RecordType.DeveloperName},

&apos;Human_Ethics_Application&apos;, &apos;Human Ethics&apos;,
&apos;Research_Governance_Authorisation&apos;, &apos;Human Ethics&apos;,

&apos;Animal_Ethics_Application&apos;, &apos;Animal Ethics&apos;,
&apos;I_RS_SOP_Phenotype_Report&apos;, &apos;Animal Ethics&apos;,

&apos;Biosafety_Ethics_Application&apos;, &apos;Institutional Biosafety Committee&apos;,

&apos;&apos;)</expression>
    </formulas>
    <interviewLabel>Ethics Review Outcome Update - Send Email {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Ethics Review Outcome Update - Send Email</label>
    <loops>
        <name>Loop_through_Ethics_Pesonnel</name>
        <label>Loop through Ethics Pesonnel</label>
        <locationX>1970</locationX>
        <locationY>807</locationY>
        <collectionReference>AllEthicsPersonnel</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Personnel_is_valid_for_CC</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Get_Up_To_Date_List_on_Related_File_Names</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Get_Email_Template_Id</name>
        <label>Get Email Template Id</label>
        <locationX>1931</locationX>
        <locationY>385</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Organisation_Wide_Address</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_Email_Template_Matrix.Email_Template_Name__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>EmailTemplate</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get correct email template based on record details</description>
        <name>Get_Email_Template_Matrix</name>
        <label>Get Email Template Matrix</label>
        <locationX>1694</locationX>
        <locationY>374</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Email_Template_Matrix_Found</targetReference>
        </connector>
        <faultConnector>
            <targetReference>ErrorOutcome</targetReference>
        </faultConnector>
        <filterLogic>1 AND 2 AND 3 AND (4 OR 5 OR 6)</filterLogic>
        <filters>
            <field>Application_Review_Outcome__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>StatusValue</elementReference>
            </value>
        </filters>
        <filters>
            <field>I_RS_Active__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>I_RS_Ethics_Object__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>ObjectType</elementReference>
            </value>
        </filters>
        <filters>
            <field>Record_Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>targetRecordTypeName</elementReference>
            </value>
        </filters>
        <filters>
            <field>Record_Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>All</stringValue>
            </value>
        </filters>
        <filters>
            <field>Record_Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>ethicsRequestRecordTypeName</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Ethics_Alert_Template_Matrix__mdt</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>Email_Template_Name__c</queriedFields>
        <queriedFields>I_RS_Template_needs_Related_File_names__c</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Ethics_Personnel</name>
        <label>Get Ethics Personnel</label>
        <locationX>2048</locationX>
        <locationY>604</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_through_Ethics_Pesonnel</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>I_RS_Ethics_Request__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>EthicsRequestId</elementReference>
            </value>
        </filters>
        <object>Research_Personnel__c</object>
        <outputReference>AllEthicsPersonnel</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>I_RS_Contact_Researcher__c</queriedFields>
        <queriedFields>I_RS_Has_active_PRIME_login__c</queriedFields>
        <queriedFields>I_RS_End_Date__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <description>Get Ethics Post Approval initiating action, if applicable</description>
        <name>Get_Ethics_Post_Approval</name>
        <label>Get Ethics Post Approval</label>
        <locationX>645</locationX>
        <locationY>328</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Set_Ethics_Request_Id_to_parent_field</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>targetRecordId</elementReference>
            </value>
        </filters>
        <object>Ethics_Post_Approval__c</object>
        <outputReference>EthicsPostApproval</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>I_RS_Ethics_Request__c</queriedFields>
        <queriedFields>RecordTypeId</queriedFields>
        <queriedFields>I_RS_Review_Outcome__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <description>Irrespective of entry point, get parent Ethics Request as it has key fields and object relationships.</description>
        <name>Get_Ethics_Request</name>
        <label>Get Ethics Request</label>
        <locationX>903</locationX>
        <locationY>191</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Ethics_Request_has_Principal_Investigator</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>EthicsRequestId</elementReference>
            </value>
        </filters>
        <object>Ethics_Request__c</object>
        <outputReference>EthicsRequest</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>I_RS_Principal_Investigator_Contact__c</queriedFields>
        <queriedFields>RecordTypeId</queriedFields>
        <queriedFields>I_RS_Ethics_Application_Review_Outcome__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Organisation_Wide_Address</name>
        <label>Get Organisation-Wide Address</label>
        <locationX>2083</locationX>
        <locationY>478</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Initialise_Contact_to_add_to_To_list</targetReference>
        </connector>
        <faultConnector>
            <targetReference>ErrorOutcome</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DisplayName</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>OrganisationWideAddressDisplayName</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>OrgWideEmailAddress</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <description>Save the recently-updated change to Ethics Request&apos;s concatenated files names field</description>
        <name>Save_Concatenated_Files_on_Ethics_Request</name>
        <label>Save Concatenated Files on Ethics Request</label>
        <locationX>1437</locationX>
        <locationY>960</locationY>
        <connector>
            <targetReference>Send_Email</targetReference>
        </connector>
        <faultConnector>
            <targetReference>ErrorOutcome</targetReference>
        </faultConnector>
        <inputReference>EthicsRequest</inputReference>
    </recordUpdates>
    <start>
        <locationX>225</locationX>
        <locationY>245</locationY>
        <connector>
            <targetReference>Object_Type_Set_Target_Id</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <name>AllEthicsPersonnel</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Research_Personnel__c</objectType>
    </variables>
    <variables>
        <name>ContactsForCCIdSet</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>The list of individuals to include as CCs.</description>
        <name>ContactsForCCList</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contact</objectType>
    </variables>
    <variables>
        <name>ContactsForToList</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contact</objectType>
    </variables>
    <variables>
        <name>ContactToAddToCCList</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contact</objectType>
    </variables>
    <variables>
        <name>ContacttoAddtoToList</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contact</objectType>
    </variables>
    <variables>
        <description>Specific error message to surface to user</description>
        <name>ErrorMessage</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <description>The Ethics Post Approval initiating the email send, if applicable</description>
        <name>EthicsPostApproval</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Ethics_Post_Approval__c</objectType>
    </variables>
    <variables>
        <description>The Ethics Request we are sending the expiry email for.</description>
        <name>EthicsRequest</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Ethics_Request__c</objectType>
    </variables>
    <variables>
        <description>The record Id of the Ethics Request that the Research Personnel are linked to.</description>
        <name>EthicsRequestId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>ethicsRequestRecordTypeName</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Used when an occur occurs - pass this variable up to any parent flows to surface them to the user</description>
        <name>IsError</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <value>
            <booleanValue>false</booleanValue>
        </value>
    </variables>
    <variables>
        <description>Simple boolean that indicates the send occurred successfully, i.e. didn&apos;t fail due to an exception</description>
        <name>IsSuccess</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <value>
            <booleanValue>false</booleanValue>
        </value>
    </variables>
    <variables>
        <description>Salesforce has a daily limit for email recipients send through Apex (which has cc&apos;ing capability). If the limit is reached, we need to handle that scenario by postponing the send until the next day.</description>
        <name>maxDailyRecipientsReached</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <value>
            <booleanValue>false</booleanValue>
        </value>
    </variables>
    <variables>
        <description>Task to insert that records outcome of email send</description>
        <name>NewTask</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Task</objectType>
    </variables>
    <variables>
        <name>NewTaskRecordTypeId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Currently can be Ethics_Request__c or Ethics_Post_Approval__c</description>
        <name>ObjectType</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>StaticEmailAddresses</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>The particular status of the Ethics object to send an email for. This is typically the Ethics Application Review outcome but there are exceptions.</description>
        <name>StatusValue</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>The record Id of the custom object we sending the email template for, i.e. Ethics Request record Id or Ethics Post Approval Record Id</description>
        <name>targetRecordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>targetRecordTypeName</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
