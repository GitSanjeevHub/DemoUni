<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <description>Check if this particular Budget&apos;s Project Proposal is locked</description>
        <name>Check_if_Budget_is_locked</name>
        <label>Check if Budget is locked</label>
        <locationX>151</locationX>
        <locationY>384</locationY>
        <actionName>FlowUtility</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Record_is_locked_decision</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>recordIds</name>
            <value>
                <elementReference>SingleBudget.I_RS_Project_Proposal__c</elementReference>
            </value>
        </inputParameters>
        <outputParameters>
            <assignToReference>Recordislocked</assignToReference>
            <name>isLocked</name>
        </outputParameters>
    </actionCalls>
    <apiVersion>49.0</apiVersion>
    <assignments>
        <name>Assign_Values</name>
        <label>Assign Values</label>
        <locationX>1112</locationX>
        <locationY>320</locationY>
        <assignmentItems>
            <assignToReference>Counter</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>BudgetLineItemCollection</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Collection_Decision</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Values_to_BLIs</name>
        <label>Assign Values to BLIs</label>
        <locationX>1196</locationX>
        <locationY>474</locationY>
        <assignmentItems>
            <assignToReference>SingleBudgetLineItem.I_RS_Budget__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>NewBudgetID</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Assign_Values_to_BLIs_Final_Collection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Values_to_BLIs_Final_Collection</name>
        <label>Assign Values to BLIs Final Collection</label>
        <locationX>1196</locationX>
        <locationY>674</locationY>
        <assignmentItems>
            <assignToReference>BLIFinalCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>SingleBudgetLineItem</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Collection</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Collection_Decision</name>
        <label>Collection Decision</label>
        <locationX>917</locationX>
        <locationY>322</locationY>
        <defaultConnector>
            <targetReference>EndScreen</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Collection_is_not_null</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Counter</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Loop_Collection</targetReference>
            </connector>
            <label>Collection is not null</label>
        </rules>
    </decisions>
    <decisions>
        <name>Record_is_locked_decision</name>
        <label>Record is locked</label>
        <locationX>151</locationX>
        <locationY>517</locationY>
        <defaultConnector>
            <targetReference>Locked_Screen</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Record_is_locked_decision_No</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Recordislocked</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>StartScreen</targetReference>
            </connector>
            <label>No</label>
        </rules>
    </decisions>
    <decisions>
        <name>User_is_Researcher</name>
        <label>User is Researcher</label>
        <locationX>147</locationX>
        <locationY>268</locationY>
        <defaultConnector>
            <targetReference>StartScreen</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>User_is_Researcher_Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>User_Type</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>PowerPartner</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Check_if_Budget_is_locked</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <formulas>
        <name>DetailPage</name>
        <dataType>String</dataType>
        <expression>LEFT({!$Api.Partner_Server_URL_260}, FIND( &apos;/services&apos;, {!$Api.Partner_Server_URL_260}))&amp;{!NewBudgetID}</expression>
    </formulas>
    <formulas>
        <description>&apos;PowerPartner&apos; refers to researcher user</description>
        <name>User_Type</name>
        <dataType>String</dataType>
        <expression>TEXT({!$User.UserType})</expression>
    </formulas>
    <interviewLabel>Budget {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Budget: Deep Clone Flow</label>
    <loops>
        <name>Loop_Collection</name>
        <label>Loop Collection</label>
        <locationX>931</locationX>
        <locationY>493</locationY>
        <assignNextValueToReference>SingleBudgetLineItem</assignNextValueToReference>
        <collectionReference>BudgetLineItemCollection</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assign_Values_to_BLIs</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Create_BLIs</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>Flow</processType>
    <recordCreates>
        <name>Create_BLIs</name>
        <label>Create BLIs</label>
        <locationX>934</locationX>
        <locationY>663</locationY>
        <connector>
            <targetReference>EndScreen</targetReference>
        </connector>
        <inputReference>BLIFinalCollection</inputReference>
    </recordCreates>
    <recordCreates>
        <name>Create_Budget</name>
        <label>Create Budget</label>
        <locationX>955</locationX>
        <locationY>96</locationY>
        <assignRecordIdToReference>NewBudgetID</assignRecordIdToReference>
        <connector>
            <targetReference>Get_BLIs</targetReference>
        </connector>
        <inputAssignments>
            <field>Default_Non_salary_Overhead__c</field>
            <value>
                <elementReference>SingleBudget.Default_Non_salary_Overhead__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Default_Rate_Type__c</field>
            <value>
                <elementReference>SingleBudget.Default_Rate_Type__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>I_RS_Actual_Non_Salary_Overhead__c</field>
            <value>
                <elementReference>SingleBudget.I_RS_Actual_Non_Salary_Overhead__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>I_RS_Actual_Overhead__c</field>
            <value>
                <elementReference>SingleBudget.I_RS_Actual_Overhead__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>I_RS_Actual_Profit__c</field>
            <value>
                <elementReference>SingleBudget.I_RS_Actual_Profit__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>I_RS_Actual_Rate_Type__c</field>
            <value>
                <elementReference>SingleBudget.I_RS_Actual_Rate_Type__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>I_RS_Amount__c</field>
            <value>
                <elementReference>SingleBudget.I_RS_Amount__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>I_RS_Approved__c</field>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>I_RS_Base_Salary__c</field>
            <value>
                <elementReference>SingleBudget.I_RS_Base_Salary__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>I_RS_Daily_On_Costs__c</field>
            <value>
                <elementReference>SingleBudget.I_RS_Daily_On_Costs__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>I_RS_Daily_Overheads__c</field>
            <value>
                <elementReference>SingleBudget.I_RS_Daily_Overheads__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>I_RS_Daily_Profits__c</field>
            <value>
                <elementReference>SingleBudget.I_RS_Daily_Profits__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>I_RS_Daily_Salary__c</field>
            <value>
                <elementReference>SingleBudget.I_RS_Daily_Salary__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>I_RS_Description__c</field>
            <value>
                <elementReference>Description</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>I_RS_IsClone__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>I_RS_La_Trobe_On_Costs__c</field>
            <value>
                <elementReference>SingleBudget.I_RS_La_Trobe_On_Costs__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>I_RS_Lead_Chief_Investigator__c</field>
            <value>
                <elementReference>SingleBudget.I_RS_Lead_Chief_Investigator__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>I_RS_Maximum_Allowed_On_Cost__c</field>
            <value>
                <elementReference>SingleBudget.I_RS_Maximum_Allowed_On_Cost__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>I_RS_Overhead__c</field>
            <value>
                <elementReference>SingleBudget.I_RS_Overhead__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>I_RS_Profit__c</field>
            <value>
                <elementReference>SingleBudget.I_RS_Profit__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>I_RS_Project_Proposal__c</field>
            <value>
                <elementReference>SingleBudget.I_RS_Project_Proposal__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>I_RS_Status__c</field>
            <value>
                <stringValue>Draft</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>I_RS_Year__c</field>
            <value>
                <elementReference>SingleBudget.I_RS_Year__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Name</field>
            <value>
                <elementReference>Budget_Name</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Organisation__c</field>
            <value>
                <elementReference>SingleBudget.Organisation__c</elementReference>
            </value>
        </inputAssignments>
        <object>Budget__c</object>
    </recordCreates>
    <recordLookups>
        <name>Get_BLIs</name>
        <label>Get BLIs</label>
        <locationX>1115</locationX>
        <locationY>111</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Assign_Values</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>I_RS_Budget__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <object>Budget_Line_Item__c</object>
        <outputReference>BudgetLineItemCollection</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>I_RS_Description__c</queriedFields>
        <queriedFields>I_RS_Organisation__c</queriedFields>
        <queriedFields>I_RS_Contact__c</queriedFields>
        <queriedFields>I_RS_Category__c</queriedFields>
        <queriedFields>I_RS_Amount__c</queriedFields>
        <queriedFields>I_RS_In_Kind__c</queriedFields>
        <queriedFields>Unit_Price__c</queriedFields>
        <queriedFields>I_RS_Sub_Category__c</queriedFields>
        <queriedFields>I_RS_Status__c</queriedFields>
        <queriedFields>I_RS_SAP_Category__c</queriedFields>
        <queriedFields>RecordTypeId</queriedFields>
        <queriedFields>I_RS_Unit_of_Time__c</queriedFields>
        <queriedFields>Year_1_Cost__c</queriedFields>
        <queriedFields>Year_1_Quantity__c</queriedFields>
        <queriedFields>Year_2_Cost__c</queriedFields>
        <queriedFields>Year_2_Quantity__c</queriedFields>
        <queriedFields>Year_3_Cost__c</queriedFields>
        <queriedFields>Year_3_Quantity__c</queriedFields>
        <queriedFields>Year_4_Cost__c</queriedFields>
        <queriedFields>Year_4_Quantity__c</queriedFields>
        <queriedFields>Year_5_Cost__c</queriedFields>
        <queriedFields>Year_5_Quantity__c</queriedFields>
        <queriedFields>Year_6_Cost__c</queriedFields>
        <queriedFields>Year_6_Quantity__c</queriedFields>
        <queriedFields>Year_7_Cost__c</queriedFields>
        <queriedFields>Year_7_Quantity__c</queriedFields>
        <queriedFields>I_RS_Cash_Amount_Inc_GST_Currency__c</queriedFields>
        <queriedFields>I_RS_Organisation_Being_Funded__c</queriedFields>
        <queriedFields>Justification__c</queriedFields>
        <queriedFields>I_RS_Short_Fall__c</queriedFields>
        <queriedFields>I_RS_Year_1_Base_Salary__c</queriedFields>
        <queriedFields>I_RS_Year_2_Base_Salary__c</queriedFields>
        <queriedFields>I_RS_Year_3_Base_Salary__c</queriedFields>
        <queriedFields>I_RS_Year_4_Base_Salary__c</queriedFields>
        <queriedFields>I_RS_Year_5_Base_Salary__c</queriedFields>
        <queriedFields>I_RS_Year_6_Base_Salary__c</queriedFields>
        <queriedFields>I_RS_Year_7_Base_Salary__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Budget_Details</name>
        <label>Get Budget Details</label>
        <locationX>160</locationX>
        <locationY>131</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>User_is_Researcher</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <object>Budget__c</object>
        <outputReference>SingleBudget</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Name</queriedFields>
        <queriedFields>I_RS_Project_Proposal__c</queriedFields>
        <queriedFields>Organisation__c</queriedFields>
        <queriedFields>I_RS_Description__c</queriedFields>
        <queriedFields>I_RS_Amount__c</queriedFields>
        <queriedFields>I_RS_Overhead__c</queriedFields>
        <queriedFields>I_RS_Profit__c</queriedFields>
        <queriedFields>Default_Rate_Type__c</queriedFields>
        <queriedFields>I_RS_Actual_Non_Salary_Overhead__c</queriedFields>
        <queriedFields>I_RS_Actual_Overhead__c</queriedFields>
        <queriedFields>I_RS_Actual_Profit__c</queriedFields>
        <queriedFields>I_RS_Actual_Rate_Type__c</queriedFields>
        <queriedFields>I_RS_Daily_On_Costs__c</queriedFields>
        <queriedFields>I_RS_Daily_Overheads__c</queriedFields>
        <queriedFields>I_RS_Daily_Profits__c</queriedFields>
        <queriedFields>I_RS_Daily_Salary__c</queriedFields>
        <queriedFields>I_RS_Base_Salary__c</queriedFields>
        <queriedFields>I_RS_Lead_Chief_Investigator__c</queriedFields>
        <queriedFields>I_RS_Maximum_Allowed_On_Cost__c</queriedFields>
        <queriedFields>I_RS_Year__c</queriedFields>
        <queriedFields>Default_Non_salary_Overhead__c</queriedFields>
        <queriedFields>I_RS_La_Trobe_On_Costs__c</queriedFields>
        <queriedFields>I_RS_Charge_Out_Rate_Comment__c</queriedFields>
    </recordLookups>
    <recordUpdates>
        <description>Sets the isClone button to false</description>
        <name>Update_Budget</name>
        <label>Update Budget</label>
        <locationX>944</locationX>
        <locationY>792</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>NewBudgetID</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>I_RS_IsClone__c</field>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </inputAssignments>
        <object>Budget__c</object>
    </recordUpdates>
    <screens>
        <name>EndScreen</name>
        <label>End Screen</label>
        <locationX>522</locationX>
        <locationY>791</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>Clone_Budget_Message_0</name>
            <extensionName>c:scriptDisplayFSC</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>callscript</name>
                <value>
                    <stringValue>Budget Copied!</stringValue>
                </value>
            </inputParameters>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>Blank</name>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Budgettest</name>
            <fieldText>&lt;p&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;Click &lt;/span&gt;&lt;a href=&quot;{!DetailPage}&quot; target=&quot;_blank&quot; style=&quot;font-size: 14px;&quot;&gt;here&lt;/a&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt; to view the copied record.&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>false</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <description>Screen to show Budget cannot be accessed due to Project Proposal being locked</description>
        <name>Locked_Screen</name>
        <label>Locked Screen</label>
        <locationX>156</locationX>
        <locationY>660</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <fields>
            <name>Locked_text</name>
            <fieldText>&lt;p&gt;This Budget is locked due to it&apos;s Project or Project Proposal&apos;s status. Please contact your Research Office Contact.&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>false</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>StartScreen</name>
        <label>StartScreen</label>
        <locationX>778</locationX>
        <locationY>96</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Create_Budget</targetReference>
        </connector>
        <fields>
            <name>Clone_Budget_Message</name>
            <extensionName>c:scriptDisplayFSC</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>callscript</name>
                <value>
                    <stringValue>Copy Budget</stringValue>
                </value>
            </inputParameters>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>Blank2</name>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Budget_Name</name>
            <dataType>String</dataType>
            <defaultValue>
                <stringValue>Copy of {!SingleBudget.Name}</stringValue>
            </defaultValue>
            <fieldText>Budget Name</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
            <validationRule>
                <errorMessage>&lt;p&gt;Maximum character is 80 &lt;/p&gt;</errorMessage>
                <formulaExpression>LEN({!Budget_Name}) &lt; 80</formulaExpression>
            </validationRule>
        </fields>
        <fields>
            <name>Description</name>
            <defaultValue>
                <stringValue>{!SingleBudget.I_RS_Description__c}</stringValue>
            </defaultValue>
            <fieldText>Description</fieldText>
            <fieldType>LargeTextArea</fieldType>
            <isRequired>false</isRequired>
            <validationRule>
                <errorMessage>&lt;p&gt;Maximum character is 255&lt;/p&gt;</errorMessage>
                <formulaExpression>LEN({!Description}) &lt; 255</formulaExpression>
            </validationRule>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <start>
        <locationX>34</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_Budget_Details</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <name>BLIFinalCollection</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Budget_Line_Item__c</objectType>
    </variables>
    <variables>
        <name>BudgetLineItemCollection</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Budget_Line_Item__c</objectType>
    </variables>
    <variables>
        <name>Counter</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>NewBudgetID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>recordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>This Budget is locked due to its Project Proposal being locked</description>
        <name>Recordislocked</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>SingleBudget</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Budget__c</objectType>
    </variables>
    <variables>
        <name>SingleBudgetLineItem</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Budget_Line_Item__c</objectType>
    </variables>
</Flow>
